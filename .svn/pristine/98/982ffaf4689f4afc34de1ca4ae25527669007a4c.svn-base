package flow.subflow.TVP_Process;

import java.util.Collection;
import java.util.Iterator;

import com.avaya.sce.runtime.Choice;
import com.avaya.sce.runtimecommon.ITraceInfo;
import com.avaya.sce.runtimecommon.SCESession;
import com.hp.utilities.IVRConstants;
import com.hp.utilities.TVP_Properties;

import flow.IProjectVariables;

/**
 * Class that represents a menu.  A menu can contain prompts, choices and links
 * as well as handlers for various events that may occur while the menu is executing
 * Last generated by Orchestration Designer at: 2015-NOV-02  11:34:16 AM
 */
public class Mnu_POAType extends com.avaya.sce.runtime.Menu {

	//{{START:CLASS:FIELDS
	//}}END:CLASS:FIELDS

	/**
	 * Default constructor
	 * Last generated by Orchestration Designer at: 2015-NOV-02  11:34:16 AM
	 */
	public Mnu_POAType() {
		//{{START:CLASS:CONSTRUCTOR
		super();
		setNeedsDefaultDisconnectHandler(false);
		//}}END:CLASS:CONSTRUCTOR
	}

	/**
	 * This method is generated automatically and should not be manually edited.
	 * To manually edit the links for the node, override:
	 *     void updateLinks(Collection links, SCESession mySession)
	 * Last generated by Orchestration Designer at: 2017-JUL-12  01:45:40 PM
	 * @return a collection of links
	 */
	public java.util.Collection getLinks(com.avaya.sce.runtimecommon.SCESession mySession) {
		com.avaya.sce.runtime.Link link;
		java.util.List list;
		java.util.Collection grammarInfo = null;
		java.util.Collection<com.avaya.sce.runtime.CaptureExpression> captureExpr = null;
		// This item does not have any defined links
		list = new java.util.ArrayList();
		String ___tempGrammarName = null;

		return(list);
	}
	/**
	 * This method is generated automatically and should not be manually edited.
	 * To manually edit the properties for the node, override:
	 *     void updateProperties(Collection properties, SCESession mySession)
	 * Last generated by Orchestration Designer at: 2017-JUL-12  01:45:40 PM
	 * @return a collection of properties
	 */
	public java.util.Collection getProperties(com.avaya.sce.runtimecommon.SCESession mySession) {
		com.avaya.sce.runtime.Property property;
		java.util.List list;
		// This item does not have any defined properties
		list = new java.util.ArrayList();

		return(list);
	}
	/**
	 * This method is generated automatically and should not be manually edited.
	 * To manually edit the event handlers for the node, override:
	 *    void updateEvents(Collection events, SCESession mySession)
	 * Last generated by Orchestration Designer at: 2017-JUL-12  01:45:40 PM
	 * @return a collection of Events
	 */
	public java.util.Collection getEvents(com.avaya.sce.runtimecommon.SCESession mySession) {
		java.util.List list;
		com.avaya.sce.runtime.Event event;
		list = new java.util.ArrayList(4);
		java.util.List eventPromptNames = null;
		String ___tempPromptName = null;

		// build the list of prompt names
		eventPromptNames = new java.util.ArrayList(1);
		
		eventPromptNames.add(new com.avaya.sce.runtime.PromptRefInfo("No_input", ""));

		event = new com.avaya.sce.runtime.Event(com.avaya.sce.runtimecommon.SCERT.EVENT_NOINPUT, (com.avaya.sce.runtime.PromptRefInfo[])eventPromptNames.toArray(new com.avaya.sce.runtime.PromptRefInfo[0]), new com.avaya.sce.runtime.Throw("maxnoinput", "VAR_Config:max_noinput", null, false));
		list.add(event);

		// build the list of prompt names
		eventPromptNames = new java.util.ArrayList(1);
		
		eventPromptNames.add(new com.avaya.sce.runtime.PromptRefInfo("No_match", ""));

		event = new com.avaya.sce.runtime.Event(com.avaya.sce.runtimecommon.SCERT.EVENT_NOMATCH, (com.avaya.sce.runtime.PromptRefInfo[])eventPromptNames.toArray(new com.avaya.sce.runtime.PromptRefInfo[0]), new com.avaya.sce.runtime.Throw("maxnomatch", "VAR_Config:max_nomatch", null, false));
		list.add(event);

		// build the list of prompt names
		eventPromptNames = new java.util.ArrayList(1);
		
		eventPromptNames.add(new com.avaya.sce.runtime.PromptRefInfo("Ann_Max", ""));

		event = new com.avaya.sce.runtime.Event("maxnoinput", (com.avaya.sce.runtime.PromptRefInfo[])eventPromptNames.toArray(new com.avaya.sce.runtime.PromptRefInfo[0]), new com.avaya.sce.runtime.Goto("TVP_Process-Ret_CallDisconnect", 0, true, ""));
		list.add(event);

		// build the list of prompt names
		eventPromptNames = new java.util.ArrayList(1);
		
		eventPromptNames.add(new com.avaya.sce.runtime.PromptRefInfo("Ann_Max", ""));

		event = new com.avaya.sce.runtime.Event("maxnomatch", (com.avaya.sce.runtime.PromptRefInfo[])eventPromptNames.toArray(new com.avaya.sce.runtime.PromptRefInfo[0]), new com.avaya.sce.runtime.Goto("TVP_Process-Ret_CallDisconnect", 0, true, ""));
		list.add(event);
		return(list);
	}
	@Override
	public void requestBegin(SCESession mySession) {
		// TODO Auto-generated method stub
		super.requestBegin(mySession);
		
		
			String strPath=mySession.getVariableField(IProjectVariables.CALL_INFO,IProjectVariables.CALL_INFO_FIELD_MENU_TRAVERSAL).getStringValue();
			strPath=strPath+"RTELV_MN00009"+"|";
			mySession.getVariableField(IProjectVariables.CALL_INFO,IProjectVariables.CALL_INFO_FIELD_MENU_TRAVERSAL).setValue(strPath);
		
	}

	/**
	 * Builds the list of choices for the menu.  This list is built
	 * automatically by the code generator and should not be edited
	 * manually.  Future code generation may overwrite any changes
	 * to this method.<br>
	 * To modify the list of choices, override:<br>
	 *    updateChoices(Collection choices, SCESession mySession)
	 * Last generated by Orchestration Designer at: 2017-JUL-12  01:45:40 PM
	 */
	public java.util.Collection getChoices(com.avaya.sce.runtimecommon.SCESession mySession) {
		java.util.List list = null;
		com.avaya.sce.runtime.Choice choice = null;
		java.util.Collection grammarInfo = null;
		list = new java.util.ArrayList(6);
		String ___tempGrammarName = null;

		// build the list of grammar information objects for the choice
		grammarInfo = new java.util.ArrayList();


		choice = new com.avaya.sce.runtime.Choice("ID1", "1", true, "exact", "TVP_Process-Dat_checkPOAType", grammarInfo, true);
		list.add(choice);

		// build the list of grammar information objects for the choice
		grammarInfo = new java.util.ArrayList();


		choice = new com.avaya.sce.runtime.Choice("ID2", "2", true, "exact", "TVP_Process-Dat_checkPOAType", grammarInfo, true);
		list.add(choice);

		// build the list of grammar information objects for the choice
		grammarInfo = new java.util.ArrayList();


		choice = new com.avaya.sce.runtime.Choice("ID3", "3", true, "exact", "TVP_Process-Dat_checkPOAType", grammarInfo, true);
		list.add(choice);

		// build the list of grammar information objects for the choice
		grammarInfo = new java.util.ArrayList();


		choice = new com.avaya.sce.runtime.Choice("ID4", "4", true, "exact", "TVP_Process-Dat_checkPOAType", grammarInfo, true);
		list.add(choice);

		// build the list of grammar information objects for the choice
		grammarInfo = new java.util.ArrayList();


		choice = new com.avaya.sce.runtime.Choice("ID5", "5", true, "exact", "TVP_Process-Dat_checkPOAType", grammarInfo, true);
		list.add(choice);

		// build the list of grammar information objects for the choice
		grammarInfo = new java.util.ArrayList();


		choice = new com.avaya.sce.runtime.Choice("ID6", "6", true, "exact", "TVP_Process-Dat_checkPOAType", grammarInfo, true);
		list.add(choice);

		return(list);
	}
	/**
	 * Builds the list of prompts that are used by this flow item<br>
	 * This method is generated automatically and changes to it may
	 * be overwritten next time code is generated.  To modify the list
	 * of prompts for the flow item, override:
	 *     updatePrompts(Collection prompts, SCESession mySession)
	 * @return list of prompts for the menu
	 * Last generated by Orchestration Designer at: 2017-JUL-12  01:45:40 PM
	 */
	public java.util.Collection getPrompts(com.avaya.sce.runtimecommon.SCESession mySession) {
		java.util.List list = null;
		String ___tempPromptName = null;
		// build the list of prompt names
		list = new java.util.ArrayList(1);
		
		list.add(new com.avaya.sce.runtime.PromptRefInfo("Ann_POAType", ""));

		return(list);
	}
	/**
	 * Builds the list of tracking items that are generated by this flow item<br>
	 * This method is generated automatically and changes to it may
	 * be overwritten next time code is generated.
	 * @return list of tracking items for the item
	 * Last generated by Orchestration Designer at: 2017-JUL-12  01:45:40 PM
	 */
	public java.util.Collection getTrackingActions(com.avaya.sce.runtimecommon.SCESession mySession) {
		java.util.List list = null;

		// Item has no tracking items.
		list = new java.util.ArrayList();
		return(list);
	}

	@Override
	public void updateChoices(Collection choices, SCESession mySession) {
		// TODO Auto-generated method stub
		super.updateChoices(choices, mySession);
		
		String configFilePath	= IVRConstants.EMPTY_QUOTES;
		TVP_Properties TVP_Prop = null;
		String POAType 			= IVRConstants.EMPTY_QUOTES;
		String[] poaArr			= null;	
		int dtmf 				= IVRConstants.ZERO;
		int number_OfPOA 		= IVRConstants.ZERO;
		ITraceInfo itraceInfo		= null;	
		try{
				
				itraceInfo              = mySession.getTraceOutput();
				configFilePath 			= mySession.getVariableField(IProjectVariables.VAR__CONFIG,IProjectVariables.VAR__CONFIG_FIELD_CONFIG_FILE_PATH).getStringValue();
				itraceInfo.writeln(ITraceInfo.TRACE_LEVEL_DEBUG, "configFilePath: "+configFilePath );
				TVP_Prop 				= TVP_Properties.getInstance(configFilePath, mySession);	
				POAType					= TVP_Prop.getProperty(mySession,IVRConstants.POAType).trim();
				itraceInfo.writeln(ITraceInfo.TRACE_LEVEL_DEBUG, "POAType Configured: "+POAType );
				poaArr  				= POAType.split(",");
				number_OfPOA 		    = poaArr.length;
				for(int i =0;i<number_OfPOA;i++)
				{
				mySession.getVariableField(IProjectVariables.TVP__POATYPE,IVRConstants.POA+(i+1)).setValue(poaArr[i].trim());
				}
				mySession.getVariableField(IProjectVariables.TVP__POATYPE,IProjectVariables.TVP__POATYPE_FIELD_TOTAL_IDS).setValue(number_OfPOA);
				Iterator<Choice> iterator = choices.iterator();
				Choice choice			  = null;
				
			
			while (iterator.hasNext()){
				
				choice = (Choice)iterator.next();
				dtmf = Integer.parseInt(choice.getDtmf());
				
				if((dtmf > number_OfPOA)){
					
					choice.setEnabled(false);
				}
				
			}
		}
			catch(Exception e){
				itraceInfo.writeln(ITraceInfo.TRACE_LEVEL_DEBUG, "Exception in Mnu_POATpe.jave "+e.getMessage());
			}
	}

	
}
